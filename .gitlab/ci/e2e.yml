# E2E test jobs

.playwright-cache: &playwright-cache
  cache:
    key: playwright-$CI_COMMIT_REF_SLUG
    paths:
      - ~/.cache/ms-playwright/
    policy: pull-push

e2e:playwright:
  stage: e2e
  image: mcr.microsoft.com/playwright:v1.57.0-noble
  <<: *playwright-cache
  needs:
    - frontend:build
  before_script:
    - npm install -g corepack@latest
    - corepack enable
    - corepack prepare pnpm@latest --activate
    - cd frontend
    - pnpm install --frozen-lockfile
  script:
    - pnpm test
  artifacts:
    when: always
    paths:
      - frontend/playwright-report/
      - frontend/test-results/
    expire_in: 30 days
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
