# Frontend CI jobs

.frontend-cache: &frontend-cache
  cache:
    key: frontend-$CI_COMMIT_REF_SLUG
    paths:
      - frontend/node_modules/
      - frontend/.pnpm-store/
    policy: pull-push

frontend:lint:
  stage: lint
  image: node:${NODE_VERSION}
  <<: *frontend-cache
  before_script:
    - corepack enable
    - corepack prepare pnpm@latest --activate
    - cd frontend
    - pnpm install --frozen-lockfile
  script:
    - pnpm lint
    - pnpm format:check
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH

frontend:build:
  stage: build
  image: node:${NODE_VERSION}
  <<: *frontend-cache
  before_script:
    - corepack enable
    - corepack prepare pnpm@latest --activate
    - cd frontend
    - pnpm install --frozen-lockfile
  script:
    - pnpm build
  artifacts:
    paths:
      - frontend/.next/
    expire_in: 1 hour
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH

frontend:docker:
  stage: build
  image: docker:latest
  services:
    - docker:dind
  script:
    - cd frontend
    - docker build -t homerp-frontend .
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
